<UserControl
    x:Class="PacMan.App.Views.GamePage"
    x:Name="Root"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:conv="using:PacMan.App.Converters"
    xmlns:selectors="using:PacMan.App.Selectors"
    mc:Ignorable="d">

    <UserControl.Resources>
        <ResourceDictionary>

            <conv:PositionConverter x:Key="PositionConverter" />
            <conv:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter" />

            <DataTemplate x:Key="PlayerTemplate">
                <Ellipse Width="16" Height="16" Fill="Yellow"/>
            </DataTemplate>

            <DataTemplate x:Key="GhostTemplate">
                <Rectangle Width="16" Height="16" Fill="Red"/>
            </DataTemplate>

            <selectors:GameObjectTemplateSelector
                x:Key="GameObjectSelector"
                PlayerTemplate="{StaticResource PlayerTemplate}"
                GhostTemplate="{StaticResource GhostTemplate}" />

        </ResourceDictionary>
    </UserControl.Resources>

    <Border Padding="20" Background="Black">

        <Grid>

            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="250"/>
            </Grid.ColumnDefinitions>

            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <TextBlock
                Grid.Row="0"
                Grid.ColumnSpan="2"
                Text="PAC-MAN"
                FontSize="42"
                FontWeight="Bold"
                Foreground="Yellow"
                HorizontalAlignment="Center"
                Margin="0,0,0,20"/>

            <Grid
                Grid.Row="1"
                Grid.Column="0"
                Width="400"
                Height="400"
                HorizontalAlignment="Center"
                VerticalAlignment="Center">

                <ItemsControl
                    ItemsSource="{Binding GameObjects}"
                    ItemTemplateSelector="{StaticResource GameObjectSelector}">

                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <Canvas/>
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>

                    <ItemsControl.ItemContainerStyle>
                        <Style TargetType="ContentPresenter">
                            <Setter Property="Canvas.Left"
                                    Value="{Binding X, Converter={StaticResource PositionConverter}, ConverterParameter=20}"/>
                            <Setter Property="Canvas.Top"
                                    Value="{Binding Y, Converter={StaticResource PositionConverter}, ConverterParameter=20}"/>
                        </Style>
                    </ItemsControl.ItemContainerStyle>

                </ItemsControl>

                <TextBlock
                    Text="Aperte ENTER para iniciar"
                    Foreground="White"
                    FontSize="24"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center"
                    Visibility="{Binding WelcomeMessageVisibility, Converter={StaticResource BoolToVisibilityConverter}}"/>

            </Grid>

            <StackPanel
                Grid.Row="1"
                Grid.Column="1"
                Margin="10"
                Padding="10"
                Background="#222">

                <TextBlock
                    Text="HIGH SCORES"
                    Foreground="Yellow"
                    FontSize="20"
                    HorizontalAlignment="Center"
                    Margin="0,0,0,10"/>

                <ListView ItemsSource="{Binding HighScores}" SelectionMode="None">
                    <ListView.ItemTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="{Binding PlayerName}" Foreground="White"/>
                                <TextBlock Text="  "/>
                                <TextBlock Text="{Binding Score}" Foreground="Cyan" FontWeight="Bold"/>
                            </StackPanel>
                        </DataTemplate>
                    </ListView.ItemTemplate>
                </ListView>

            </StackPanel>

            <TextBlock
                Grid.Row="2"
                Grid.ColumnSpan="2"
                Text="Pressione ESC para sair"
                Foreground="Gray"
                HorizontalAlignment="Center"
                Margin="0,10"/>

        </Grid>
    </Border>
</UserControl>
